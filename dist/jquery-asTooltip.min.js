/*! jQuery asTooltip - v0.2.0 - 2014-05-08
* https://github.com/amazingSurge/jquery-asTooltip
* Copyright (c) 2014 amazingSurge; Licensed GPL */
!function(a){"use strict";function b(a,b,c,d,e,f){var g,h,i,j=0,k=0;switch(f?(g=a,h=0,i=0):(g=a.offset(),h=a.outerWidth(),i=a.outerHeight()),b){case"n":j=g.left+h/2-c/2,k=g.top-d-e;break;case"e":j=g.left+h+e,k=g.top+i/2-d/2;break;case"s":j=g.left+h/2-c/2,k=g.top+i+e;break;case"w":j=g.left-c-e,k=g.top+i/2-d/2;break;case"nw":case"wn":j=g.left-c+20,k=g.top-d-e;break;case"ne":case"en":j=g.left+h-20,k=g.top-d-e;break;case"sw":case"ws":j=g.left-c+20,k=g.top+i+e;break;case"se":case"es":j=g.left+h-20,k=g.top+i+e}return{left:Math.round(j),top:Math.round(k)}}function c(a,b){var c,d,e=f.scrollLeft(),g=f.scrollTop(),h=a.offset(),i=a.outerWidth(!0),j=a.outerHeight(!0),k=f.width(),l=f.height(),m=[];return b?(c=b.outerWidth(!0),d=b.outerHeight(!0)):(c=100,d=50),h.top<g+d&&m.push("n"),h.top+j+d>g+l&&m.push("s"),h.left<e+c&&m.push("w"),h.left+i+c>e+k&&m.push("e"),m}function d(){var a=document.body||document.documentElement,b=a.style,c="transition";if("string"==typeof b[c])return!0;e=["Moz","Webkit","Khtml","O","ms"],c=c.charAt(0).toUpperCase()+c.substr(1);for(var d=0;d<e.length;d++)if("string"==typeof b[e[d]+c])return!0;return!1}var e,f=a(window),g=!1,h=[],i="nswe",j={n:{n:"s",w:"ne",e:"nw"},s:{s:"n",w:"se",e:"sw"},w:{w:"e",n:"sw",s:"nw"},e:{e:"w",n:"se",s:"ne"},nw:{n:"sw",w:"ne"},ne:{n:"se",e:"nw"},sw:{s:"nw",w:"se"},se:{s:"ne",e:"sw"}},k=!0;d()||(k=!1);var l=a.asTooltip=function(b,c){var d={};this.$elem=a(b),a.each(this.$elem.data(),function(a,b){/^asTooltip/i.test(a)&&(d[a.toLowerCase().replace(/^asTooltip/i,"")]=b)}),this.options=a.extend({},l.defaults,c,d),this.namespace=this.options.namespace,this.$elem.attr("title")&&(this.options.title=this.$elem.attr("title"),this.$elem.removeAttr("title")),this.content=null,this.target=this.options.target||this.$elem,this.isOpen=null,this.enabled=!0,this.tolerance=null,this.onlyOne=this.options.onlyOne||!1,this.init()};l.prototype={constructor:l,init:function(){var c=this.options,d=this;c.tpl=this.parseTpl(c.tpl),this.$container=a(c.tpl.container),this.$loading=a(c.tpl.loading),this.$arrow=a(c.tpl.arrow),this.$close=a(c.tpl.close),this.$content=a(c.tpl.content),"hover"===c.trigger&&(this.target.on("mouseenter.asTooltip",function(){return d.isOpen===!0?void clearTimeout(this.tolerance):void a.proxy(d.show,d)()}),c.interactive===!0?this.target.on("mouseleave.asTooltip",function(){var b=!1;d.$container.on("mouseenter.asTooltip",function(){b=!0}),d.$container.on("mouseleave.asTooltip",function(){b=!1}),clearTimeout(this.tolerance),this.tolerance=setTimeout(function(){b===!0?d.$container.on("mouseleave.asTooltip",a.proxy(d.hide,d)):a.proxy(d.hide,d)()},d.options.interactiveDelay)}):this.target.on("mouseleave.asTooltip",a.proxy(d.hide,d)),this.options.mouseTrace===!0&&this.target.on("mousemove.asTooltip",function(a){var c,e={},f=a.pageX,g=a.pageY;e={top:g,left:f},c=b(e,d.options.position,d.width,d.height,d.options.popSpace,!0),d.$container.css({display:"block",top:c.top,left:c.left})})),"click"===c.trigger&&this.target.on("click.asTooltip",function(){d.isOpen===!0?a.proxy(d.hide,d)():a.proxy(d.show,d)()}),h.push(this)},load:function(){var b=this,c=this.options;c.ajax===!0?a.ajax(a.extend({},c.ajaxSettings,{url:c.title,error:function(){throw new Error("ajax error")},success:function(a,c){"success"===c&&(b.content=a,b.$container.css({display:"none"}),b.$content.empty().append(b.content),b.$container.removeClass(b.posCss),b.setPosition())}})):this.content=c.inline===!0?-1!==c.title.indexOf("+")?this.$elem.next().css({display:"block"}):a(c.title).css({display:"block"}):c.title},parseTpl:function(b){var c={},d=this;return a.each(b,function(a,b){c[a]=b.replace("{{namespace}}",d.namespace)}),c},showLoading:function(){this.$content.empty(),this.$loading.css({display:"block"})},hideLoading:function(){this.$loading.css({display:"none"})},setPosition:function(){var d,e=this.options,f=this.namespace+"-"+e.position;if(this.width=this.$container.outerWidth(),this.height=this.$container.outerHeight(),e.mouseTrace!==!0){if(e.autoPosition===!0){var g,h=[];if(h=e.ajax===!0&&null===this.content?c(a(this.target)):c(a(this.target),this.$container),0===h.length)g=e.position;else if(1===h.length){var k=j[e.position][h[0]];g=void 0===k?e.position:k}else{var l=i;a.each(h,function(a,b){l.replace(b,"")}),g=l}f=this.namespace+"-"+g,d=b(this.target,g,this.width,this.height,this.options.popSpace)}else d=b(this.target,e.position,this.width,this.height,this.options.popSpace);this.$container.css({display:"block",top:d.top,left:d.left})}this.posCss=f,this.$container.addClass(f)},show:function(){var b=this.options,c=this;if(this.enabled)return this.onlyOne&&a.each(h,function(a,b){b!==c&&b.isOpen&&b.hide()}),b.closeBtn&&this.$container.append(this.$close),this.$container.append(this.$arrow).append(this.$content),this.$elem.addClass(this.namespace+"_active"),null===this.content&&this.load(),null===this.content?this.$content.append(this.$loading):this.$content.empty().append(this.content),b.skin&&this.$container.addClass(this.namespace+"_"+b.skin),this.$container.css({display:"none",top:0,left:0,position:"absolute",zIndex:99990}).appendTo(a("body")),this.setPosition(),"function"===b.onShow&&b.onShow(this.$elem),this.$container.trigger("show"),this.isOpen=!0,this},hide:function(){this.$container.off(".asTooltip"),this.$container.trigger("hide"),this.$elem.removeClass(this.namespace+"_active"),this.$container.remove(),this.$container.removeClass(this.posCss),"function"===this.options.onHide&&this.options.onHide(this.$elem),this.isOpen=!1,g=!1},setContent:function(a){this.content=a},enable:function(){return this.enabled=!0,this.container.addClass(this.namespace+"-enabled"),this},disable:function(){return this.enabled=!1,this.container.removeClass(this.namespace+"-enabled"),this},destroy:function(){this.target.off(".asTooltip")}},l.closeAll=function(){h.map(function(a){a.isOpen&&a.hide()})},l.defaults={namespace:"asTooltip",skin:null,target:null,onlyOne:!1,trigger:"hover",interactive:!1,interactiveDelay:500,mouseTrace:!1,closeBtn:!1,popSpace:10,position:"n",autoPosition:!0,delay:0,effect:"fade",duration:200,inline:!1,content:null,ajax:!1,ajaxSettings:{dataType:"html",headers:{asTooltip:!0}},onShow:null,onHide:null,onUpdate:null,tpl:{container:'<div class="{{namespace}}"></div>',loading:'<span class="{{namespace}}-loading"></span>',content:'<div class="{{namespace}}-content"></div>',arrow:'<span class="{{namespace}}-arrow"></span>',close:'<a class="{{namespace}}-close"></a>'}},a.fn.asTooltip=function(b){if("string"==typeof b){var c=b,d=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;return this.each(function(){var b=a.data(this,"asTooltip");"function"==typeof b[c]&&b[c].apply(b,d)})}return this.each(function(){a.data(this,"asTooltip")||a.data(this,"asTooltip",new l(this,b))})}}(jQuery);